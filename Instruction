–û—Ç–ª–∏—á–Ω–æ üëå –¢—ã —Å–∫–∏–Ω—É–ª `api.yml` ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è OpenAPI –¥–ª—è GigaChat. –î–∞–≤–∞–π —è —Å—Ä–∞–∑—É –ø–æ–¥ –Ω–µ—ë –ø–æ–¥—Å—Ç—Ä–æ—é –ø–ª–∞–Ω, —á—Ç–æ–±—ã —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç –≤—ã–≥–ª—è–¥–µ–ª –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

---

# üìå –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ ¬´–ê–≥–µ–Ω—Ç-–ø–æ–º–æ—â–Ω–∏–∫ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞¬ª

*(–æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ API –∏–∑ `api.yml` GigaChat)*

---

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –∏ –ø–∞–ø–∫–∏:

   ```
   sa-agent/
   ‚îú‚îÄ app.py                 # Streamlit UI
   ‚îú‚îÄ gigachat_client.py     # –æ–±—ë—Ä—Ç–∫–∞ –ø–æ–¥ API GigaChat
   ‚îú‚îÄ prompts/
   ‚îÇ  ‚îî‚îÄ system_prompt.txt
   ‚îú‚îÄ requirements.txt
   ‚îú‚îÄ .env
   ‚îî‚îÄ README.md
   ```
2. –í `requirements.txt`:

   ```
   streamlit
   requests
   python-dotenv
   ```
3. –í `.env`:

   ```
   GIGACHAT_API_URL=https://gigachat.devices.sberbank.ru/api/v1
   GIGACHAT_API_KEY=–í–ê–®_API_KEY
   ```

---

## 2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ä–∞–±–æ—Ç–∞ —Å API GigaChat

–°–æ–≥–ª–∞—Å–Ω–æ `api.yml`, —É GigaChat –µ—Å—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π **OAuth 2.0** –ø–æ—Ç–æ–∫:

* —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å `access_token` —á–µ—Ä–µ–∑ `POST /api/v1/oauth` (–∏–ª–∏ `/tokens` ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–µ—Ä—Å–∏–∏ —Ñ–∞–π–ª–∞);
* –ø–æ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ `Authorization: Bearer ...` –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤.

üìå –í `gigachat_client.py` –±—É–¥–µ—Ç:

* –º–µ—Ç–æ–¥ `get_token()` ‚Üí –ø–æ–ª—É—á–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω;
* –º–µ—Ç–æ–¥ `chat_completion(messages)` ‚Üí –¥–µ–ª–∞–µ—Ç `POST /chat/completions`, –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ –≤ API.

---

### üîß –®–∞–±–ª–æ–Ω gigachat_client.py

```python
import os
import requests
import time

BASE_URL = os.getenv("GIGACHAT_API_URL", "https://gigachat.devices.sberbank.ru/api/v1")
CLIENT_ID = os.getenv("GIGACHAT_CLIENT_ID")
CLIENT_SECRET = os.getenv("GIGACHAT_CLIENT_SECRET")

_token = None
_token_expiry = 0

def get_token():
    global _token, _token_expiry
    if _token and time.time() < _token_expiry:
        return _token

    url = f"{BASE_URL}/oauth/token"
    data = {
        "grant_type": "client_credentials",
        "scope": "GIGACHAT_API_PERS"
    }
    resp = requests.post(url, data=data, auth=(CLIENT_ID, CLIENT_SECRET))
    resp.raise_for_status()
    js = resp.json()
    _token = js["access_token"]
    _token_expiry = time.time() + js["expires_in"] - 60
    return _token

def chat_completion(messages, model="GigaChat", temperature=0.0):
    url = f"{BASE_URL}/chat/completions"
    headers = {"Authorization": f"Bearer {get_token()}"}
    payload = {
        "model": model,
        "messages": messages,
        "temperature": temperature
    }
    resp = requests.post(url, headers=headers, json=payload)
    resp.raise_for_status()
    return resp.json()
```

---

## 3. –ü—Ä–æ–º–ø—Ç –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞

–°—Ä–∞–∑—É —Ñ–æ—Ä–º–∏—Ä—É–µ–º –∂—ë—Å—Ç–∫–∏–π —Ñ–æ—Ä–º–∞—Ç JSON –≤ –æ—Ç–≤–µ—Ç–µ:

```json
{
  "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞",
  "bpmn_mermaid": "–∫–æ–¥ –¥–∏–∞–≥—Ä–∞–º–º—ã mermaid",
  "usecase_mermaid": "–∫–æ–¥ use-case –¥–∏–∞–≥—Ä–∞–º–º—ã mermaid",
  "requirements_md": "Markdown —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (FR/NFR)"
}
```

üëâ `system_prompt.txt`:

```
–¢—ã —Å–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫. –¢–≤–æ—è –∑–∞–¥–∞—á–∞: –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã–¥–∞—Ç—å –∞–Ω–∞–ª–∏–∑.
–í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ç—Ä–æ–≥–æ –≤ JSON —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏:
- title
- bpmn_mermaid (–∫–æ–¥ mermaid –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞)
- usecase_mermaid (–∫–æ–¥ mermaid –¥–ª—è use-case)
- requirements_md (—Ç–µ–∫—Å—Ç –≤ markdown —Å–æ —Å–ø–∏—Å–∫–∞–º–∏ FR –∏ NFR)
–ù–µ –¥–æ–±–∞–≤–ª—è–π –ø–æ—è—Å–Ω–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ JSON.
```

---

## 4. Streamlit –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (app.py)

1. –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è.
2. –ö–Ω–æ–ø–∫–∞ ¬´–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å¬ª.
3. –í–∫–ª–∞–¥–∫–∏ –¥–ª—è:

   * BPMN (—Ä–µ–Ω–¥–µ—Ä —á–µ—Ä–µ–∑ mermaid.js),
   * Use Case,
   * –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è (markdown),
   * Raw JSON.

üìå –†–µ–Ω–¥–µ—Ä mermaid:

```python
import streamlit.components.v1 as components

def render_mermaid(code: str, height=400):
    html = f"""
    <div class="mermaid">{code}</div>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({{startOnLoad:true}});</script>
    """
    components.html(html, height=height, scrolling=True)
```

---

## 5. –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ.
2. –í `app.py` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è `messages`:

   ```python
   messages = [
       {"role": "system", "content": open("prompts/system_prompt.txt").read()},
       {"role": "user", "content": user_input}
   ]
   ```
3. –ó–∞–ø—Ä–æ—Å –≤ `chat_completion(messages)`.
4. –û—Ç–≤–µ—Ç –ø–∞—Ä—Å–∏—Ç—Å—è –∫–∞–∫ JSON ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–≤–æ–¥—è—Ç—Å—è.
5. –ü—Ä–∏ –æ—à–∏–±–∫–µ JSON-–ø–∞—Ä—Å–∏–Ω–≥–∞ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç.

---

## 6. –¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã

* –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç: –≤—ã–¥–∞—á–∞ —Å–ø—Ä–∞–≤–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–∞–º.
* –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω: –∑–∞–∫–∞–∑ —Ç–æ–≤–∞—Ä–∞.
* –ü–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞: –∑–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º.

---

## 7. –ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è —Ä–µ–∑—é–º–µ

* README.md —Å:

  * –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–µ–∫—Ç–∞,
  * –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –∑–∞–ø—É—Å–∫–∞,
  * —Å–∫—Ä–∏–Ω—à–æ—Ç–∞–º–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞,
  * –ø—Ä–∏–º–µ—Ä–∞–º–∏ –≤—Ö–æ–¥/–≤—ã—Ö–æ–¥.
* –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∫–Ω–æ–ø–∫–∞ ¬´–°–∫–∞—á–∞—Ç—å –≤ Markdown¬ª –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç.